{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="dashboard-layout" style="display: flex; min-height: 100vh;">
    <!-- Sidebar -->
    <div class="sidebar" style="width: 250px; background: white; border-right: 1px solid #e5e7eb; padding: 2rem;">
        <h2 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 2rem;">{{ project_name or "EasyCamp" }}</h2>
        <nav>
            <a href="/admin-web/" style="display: block; padding: 0.75rem 0; color: #4b5563; text-decoration: none;">üè†
                –î–∞—à–±–æ—Ä–¥</a>
            <a href="/admin-web/houses"
                style="display: block; padding: 0.75rem 0; color: #4b5563; text-decoration: none;">üè°
                –î–æ–º–∞</a>
            <a href="/admin-web/bookings"
                style="display: block; padding: 0.75rem 0; color: #2563eb; font-weight: 500;">üìÖ
                –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</a>
            <a href="/admin-web/settings"
                style="display: block; padding: 0.75rem 0; color: #4b5563; text-decoration: none;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            <a href="/admin-web/logout"
                style="display: block; padding: 0.75rem 0; color: #dc2626; margin-top: 2rem; text-decoration: none;">–í—ã—Ö–æ–¥</a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main" style="flex: 1; padding: 2rem;">
        <div style="margin-bottom: 2rem;">
            <a href="/admin-web/bookings" style="color: #2563eb; text-decoration: none; font-size: 0.875rem;">‚Üê –ù–∞–∑–∞–¥ –∫
                —Å–ø–∏—Å–∫—É</a>
        </div>

        <h1 style="font-size: 1.875rem; font-weight: bold; margin-bottom: 2rem;">{{ title }}</h1>

        <form method="post" action="/admin-web/bookings/{{ booking.id }}">
            <div class="auth-card" style="max-width: 900px;">
                <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏</h2>

                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div>
                        <label class="label">–î–æ–º–∏–∫</label>
                        <select name="house_id" class="input" required>
                            {% for house in houses %}
                            <option value="{{ house.id }}" {% if house.id==booking.house_id %}selected{% endif %}>
                                {{ house.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div>
                        <label class="label">–°—Ç–∞—Ç—É—Å</label>
                        <select name="status" class="input" required>
                            <option value="new" {% if booking.status.value=='new' %}selected{% endif %}>–ù–æ–≤–∞—è</option>
                            <option value="confirmed" {% if booking.status.value=='confirmed' %}selected{% endif %}>
                                –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞</option>
                            <option value="paid" {% if booking.status.value=='paid' %}selected{% endif %}>–û–ø–ª–∞—á–µ–Ω–∞
                            </option>
                            <option value="checking_in" {% if booking.status.value=='checking_in' %}selected{% endif %}>
                                –ñ–¥—ë—Ç –∑–∞—Å–µ–ª–µ–Ω–∏—è</option>
                            <option value="checked_in" {% if booking.status.value=='checked_in' %}selected{% endif %}>
                                –ü—Ä–æ–∂–∏–≤–∞–µ—Ç</option>
                            <option value="completed" {% if booking.status.value=='completed' %}selected{% endif %}>
                                –ó–∞–≤–µ—Ä—à–µ–Ω–∞</option>
                            <option value="cancelled" {% if booking.status.value=='cancelled' %}selected{% endif %}>
                                –û—Ç–º–µ–Ω–µ–Ω–∞</option>
                        </select>
                    </div>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–æ—Å—Ç–µ -->
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem;">–ì–æ—Å—Ç—å</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div>
                        <label class="label">–ò–º—è –≥–æ—Å—Ç—è</label>
                        <input type="text" name="guest_name" class="input" value="{{ booking.guest_name }}" required>
                    </div>

                    <div>
                        <label class="label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="text" name="guest_phone" class="input" value="{{ booking.guest_phone or '' }}">
                    </div>

                    <div>
                        <label class="label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π</label>
                        <input type="number" name="guests_count" class="input" value="{{ booking.guests_count }}"
                            min="1" required>
                    </div>
                </div>

                <!-- –î–∞—Ç—ã -->
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem;">–î–∞—Ç—ã</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div>
                        <label class="label">–î–∞—Ç–∞ –∑–∞–µ–∑–¥–∞</label>
                        <input type="date" name="check_in" class="input" value="{{ booking.check_in.isoformat() }}"
                            required>
                    </div>

                    <div>
                        <label class="label">–î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞</label>
                        <input type="date" name="check_out" class="input" value="{{ booking.check_out.isoformat() }}"
                            required>
                    </div>

                    <div>
                        <label class="label">–ù–æ—á–µ–π</label>
                        <input type="text" class="input" value="{{ (booking.check_out - booking.check_in).days }}"
                            disabled>
                    </div>
                </div>

                <!-- –§–∏–Ω–∞–Ω—Å—ã -->
                <h3 style="font-size: 1.125rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem;">–§–∏–Ω–∞–Ω—Å—ã</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div>
                        <label class="label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                        <input type="number" name="total_price" class="input" value="{{ booking.total_price }}"
                            step="0.01" required>
                    </div>

                    <div>
                        <label class="label">–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ (‚ÇΩ)</label>
                        <input type="number" name="advance_amount" class="input" value="{{ booking.advance_amount }}"
                            step="0.01">
                    </div>

                    <div>
                        <label class="label">–ö–æ–º–∏—Å—Å–∏—è (‚ÇΩ)</label>
                        <input type="number" name="commission" class="input" value="{{ booking.commission }}"
                            step="0.01">
                    </div>

                    <div>
                        <label class="label">–í–ª–∞–¥–µ–ª—å—Ü—É (‚ÇΩ)</label>
                        <input type="number" name="prepayment_owner" class="input"
                            value="{{ booking.prepayment_owner }}" step="0.01">
                    </div>
                </div>

                <!-- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ -->
                <div
                    style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb; font-size: 0.875rem; color: #6b7280;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                        <div>
                            <strong>–ò—Å—Ç–æ—á–Ω–∏–∫:</strong>
                            {% if booking.source.value == 'avito' %}
                            <span style="color: #059669;">üü¢ Avito</span>
                            {% elif booking.source.value == 'telegram' %}
                            <span style="color: #2563eb;">‚úàÔ∏è Telegram</span>
                            {% else %}
                            {{ booking.source.value }}
                            {% endif %}
                        </div>
                        <div>
                            <strong>–°–æ–∑–¥–∞–Ω–æ:</strong> {{ booking.created_at.strftime('%d.%m.%Y %H:%M') }}
                        </div>
                        <div>
                            <strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> {{ booking.updated_at.strftime('%d.%m.%Y %H:%M') }}
                        </div>
                    </div>
                    {% if booking.external_id %}
                    <div style="margin-top: 0.5rem;">
                        <strong>External ID:</strong> {{ booking.external_id }}
                    </div>
                    {% endif %}
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div
                    style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb;">
                    <button type="submit" class="btn" style="width: auto; padding: 0.75rem 2rem;">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                    <a href="/admin-web/bookings" class="btn"
                        style="background: #6b7280; width: auto; padding: 0.75rem 2rem; text-decoration: none;">
                        –û—Ç–º–µ–Ω–∞
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}