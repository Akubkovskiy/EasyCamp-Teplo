# SaaS Transformation Sprint Plan

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—è —Ü–µ–ª—å
–ü–µ—Ä–µ–≤–æ–¥ EasyCamp –≤ —Å–∏—Å—Ç–µ–º—É **single-tenant white-label**:
- **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã**: –ë–î (–¥–æ–º–∞, –±—Ä–æ–Ω–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∫–æ–Ω—Ç–∞–∫—Ç—ã, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏).
- **.env**: –¢–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (DSN, —Å–µ–∫—Ä–µ—Ç—ã).
- **Self-service**: –í–ª–∞–¥–µ–ª—å—Ü—ã —É–ø—Ä–∞–≤–ª—è—é—Ç —Å–≤–æ–∏–º –∏–Ω—Å—Ç–∞–Ω—Å–æ–º —á–µ—Ä–µ–∑ –í–µ–±-–∞–¥–º–∏–Ω–∫—É.

---

## üìÖ –§–∞–∑–∞ B: –í–µ–±-–∞–¥–º–∏–Ω–∫–∞: –ö–∞—Ä–∫–∞—Å + –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–ó–∞–≤–µ—Ä—à–µ–Ω–æ)

### ‚úÖ B1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –õ–æ–≥–∏–Ω (HTML)
*   **–°–µ—Å—Å–∏—è**: –ó–∞–≤–µ—Ä—à–µ–Ω–æ.
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `GET /admin-web/login` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç `login.html`.

### üöÄ B2: –õ–æ–≥–∏–∫–∞ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
#### B2.1: POST /login + –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
*   **–ó–∞–¥–∞—á–∏**:
    *   –≠–Ω–¥–ø–æ–∏–Ω—Ç `POST /admin-web/login`.
    *   –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã (username/password).
    *   –ü–æ–∏—Å–∫ –º–æ–¥–µ–ª–∏ `User` –≤ –ë–î.
    *   –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è (Upgrade: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `passlib[bcrypt]` / `bcrypt`). (–£–±–µ–¥–∏—Ç—å—Å—è –≤ –Ω–∞–ª–∏—á–∏–∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è).
    *   `GET /admin-web/logout`.
*   **–ü—Ä–∏–µ–º–∫–∞ (Acceptance)**:
    *   –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -> –û—à–∏–±–∫–∞ –Ω–∞ —Ñ–æ—Ä–º–µ.
    *   –í–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -> –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin-web/`.

#### B2.2: –°–µ—Å—Å–∏–æ–Ω–Ω—ã–µ –∫—É–∫–∏ + Dependency
*   **–ó–∞–¥–∞—á–∏**:
    *   –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `httpOnly` cookie –¥–ª—è —Ç–æ–∫–µ–Ω–∞ —Å–µ—Å—Å–∏–∏.
    *   –°–æ–∑–¥–∞–Ω–∏–µ dependency `get_current_admin`:
        *   –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–∫–∏.
        *   –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        *   –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ (ADMIN/OWNER).
    *   –ó–∞—â–∏—Ç–∞ —Ä–æ—É—Ç–æ–≤ –¥–∞—à–±–æ—Ä–¥–∞.
*   **–ü—Ä–∏–µ–º–∫–∞ (Acceptance)**:
    *   –ê–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø -> –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`.
    *   –ê–¥–º–∏–Ω—Å–∫–∏–π –¥–æ—Å—Ç—É–ø -> –ü—Ä–æ—Å–º–æ—Ç—Ä –î–∞—à–±–æ—Ä–¥–∞.

#### B2.3: –ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã
*   **–ó–∞–¥–∞—á–∏**:
    *   –¢–µ—Å—Ç—ã `TestClient` –¥–ª—è —Ñ–ª–æ—É –ª–æ–≥–∏–Ω–∞.
*   **–ü—Ä–∏–µ–º–∫–∞ (Acceptance)**:
    *   Smoke test "–ö—É–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞", "–î–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç –ø–æ—Å–ª–µ –ª–æ–≥–∞—É—Ç–∞".
*   **–°—Ç–∞—Ç—É—Å**: DONE (Verified).

---

## üìÖ –§–∞–∑–∞ C: –ú–∞—Å—Ç–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (Onboarding)

### C1: –î–µ—Ç–µ–∫—Ç–æ—Ä –ø–µ—Ä–≤–∏—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
#### C1.1: –§–ª–∞–≥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
*   **–ó–∞–¥–∞—á–∏**:
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `GlobalSetting(key="initial_setup_done")`.
    *   Service: `SetupStateService.is_initial_setup_done()`.
    *   Middleware/Dependency: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–∞ —Å allowlist (`/login`, `/static`, `/setup`).
*   **–ü—Ä–∏–µ–º–∫–∞ (Acceptance)**: –ü—É—Å—Ç–∞—è –ë–î -> –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin-web/setup`.

#### C1.2: –ó–∞—â–∏—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
*   **–ó–∞–¥–∞—á–∏**:
    *   `SETUP_SECRET` –≤ `.env`.
    *   –†–æ—É—Ç `/admin-web/setup` —Ç—Ä–µ–±—É–µ—Ç –≤–≤–æ–¥ —Å–µ–∫—Ä–µ—Ç–∞ (—ç–∫—Ä–∞–Ω ‚Ññ1).

### C2: –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –∏ –ö–æ–Ω—Ç–∞–∫—Ç—ã)
#### C2.1: –ú–æ–¥–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫
*   **–ó–∞–¥–∞—á–∏**:
    *   –°–µ—Ä–≤–∏—Å/–¢–∞–±–ª–∏—Ü–∞ `ProjectSettings`.
*   **–ü—Ä–∏–µ–º–∫–∞ (Acceptance)**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è/–ª–æ–∫–∞—Ü–∏–∏/–∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ –ë–î.

#### C2.2: UI –ú–∞—Å—Ç–µ—Ä–∞ (–®–∞–≥–∏ 1-2)
*   **–ó–∞–¥–∞—á–∏**:
    *   –§–æ—Ä–º—ã –¥–ª—è –ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ö–æ–Ω—Ç–∞–∫—Ç–æ–≤.
    *   –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AI (Spreadsheet ID –¥–ª—è –ë–∞–∑—ã –ó–Ω–∞–Ω–∏–π).

### C3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –ê–¥–º–∏–Ω
#### C3.1: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
*   **–ó–∞–¥–∞—á–∏**:
    *   –¢–∞–±–ª–∏—Ü–∞ `IntegrationSettings` (–¢–æ–∫–µ–Ω –±–æ—Ç–∞, Avito, Sheets).
    *   –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ –ë–î –≤ –∫–æ–Ω—Ñ–∏–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
*   **–ü—Ä–∏–µ–º–∫–∞ (Acceptance)**: –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å —Ç–æ–∫–µ–Ω–æ–º –∏–∑ –ë–î (–∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è).

#### C3.2: –ü–µ—Ä–≤—ã–π –ê–¥–º–∏–Ω
*   **–ó–∞–¥–∞—á–∏**:
    *   –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è OWNER.
    *   –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `initial_setup_done = True`.

---

## üìÖ –§–∞–∑–∞ D: –î–æ–º–∞ –∏ –ö–æ–Ω—Ç–µ–Ω—Ç (Web)

### D1: CRUD –î–æ–º–æ–≤
#### D1.1: API
*   **–ó–∞–¥–∞—á–∏**: REST —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–º–∞–º–∏.
#### D1.2: UI
*   **–ó–∞–¥–∞—á–∏**: –°–ø–∏—Å–æ–∫, –°–æ–∑–¥–∞–Ω–∏–µ, –§–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
*   **–ü—Ä–∏–µ–º–∫–∞ (Acceptance)**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –í–µ–±–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –≤ –ë–æ—Ç–µ.

### D2: –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
#### D2.1: MVP (–°—Å—ã–ª–∫–∏)
*   **–ó–∞–¥–∞—á–∏**: –°–ø–∏—Å–æ–∫ URL.
#### D2.2: –ó–∞–≥—Ä—É–∑–∫–∞ (–¶–µ–ª—å)
*   **–ó–∞–¥–∞—á–∏**: –õ–æ–∫–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ `/app/data/uploads`.

---

## üìÖ –§–∞–∑–∞ E: –ö–∞–ª–µ–Ω–¥–∞—Ä—å
### E1: –ë—ç–∫–µ–Ω–¥
*   **–ó–∞–¥–∞—á–∏**: API, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–µ–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ –¥–æ–º–æ–≤.
### E2: –§—Ä–æ–Ω—Ç–µ–Ω–¥
*   **–ó–∞–¥–∞—á–∏**: –°–µ—Ç–∫–∞ –º–µ—Å—è—á–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–î–æ–º–∞ x –î–Ω–∏). –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –∫–ª–∏–∫—É.

---

## üìÖ –§–∞–∑–∞ F: –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
### F1: RBAC –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
*   **–ó–∞–¥–∞—á–∏**: –†–æ–ª–∏ (MANAGER/ADMIN), Rate Limits, CSRF.
### F2: –ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ (Audit Log)
*   **–ó–∞–¥–∞—á–∏**: –ó–∞–ø–∏—Å—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.
### F3: –î–µ–ø–ª–æ–π
*   **–ó–∞–¥–∞—á–∏**: –®–∞–±–ª–æ–Ω `docker-compose` –¥–ª—è –º—É–ª—å—Ç–∏-–∏–Ω—Å—Ç–∞–Ω—Å–∞. Runbooks.

---

### üìÖ –§–∞–∑–∞ G: AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç (Read-only ‚Üí Agent)
**G1: AI –∑–∞–≥–ª—É—à–∫–∞ + –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥**
*   –§–ª–∞–≥ `AI_ENABLED`.
*   –ö–æ–º–∞–Ω–¥–∞ –≤ –±–æ—Ç–µ: `/ask` –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ ‚Äú–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å‚Äù.
*   `AssistantServiceStub` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞–≥–ª—É—à–∫–æ–π.
*   **–ü—Ä–∏–µ–º–∫–∞ (Acceptance)**: –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞–≥–ª—É—à–∫–æ–π –∏ –Ω–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–ª–æ—É.

**G2: –í—ã–±–æ—Ä–∫–∞ –∏–∑ Sheets KB (read-only)**
*   **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**:
    *   `AI_KB_SPREADSHEET_ID` (–æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–ª–∏ whitelist –ª–∏—Å—Ç).
    *   `AI_KB_SHEET_NAME=KB`.
    *   `AI_KB_CACHE_TTL_SECONDS`.
*   **–õ–æ–≥–∏–∫–∞**: `SheetsKnowledgeProvider` —á–∏—Ç–∞–µ—Ç KB, –∏—â–µ—Ç top‚ÄëN —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å—Ç—Ä–æ–∫.
*   **–§–ª–æ—É**: –û—Ç–≤–µ—Ç—ã –≥–æ—Å—Ç—è–º + fallback –∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º.
*   **–ü—Ä–∏–µ–º–∫–∞ (Acceptance)**: –ù–∞ –≤–æ–ø—Ä–æ—Å—ã ‚ÄúWi‚ÄëFi/–ø—Ä–∞–≤–∏–ª–∞/–∫–æ–Ω—Ç–∞–∫—Ç—ã‚Äù –æ—Ç–≤–µ—á–∞–µ—Ç –∏–∑ KB. –ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç ‚Äî –æ—Ç–¥–∞—ë—Ç –∫–æ–Ω—Ç–∞–∫—Ç.

**G3: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–≥–µ–Ω—Ç–∞ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã, –ø–æ–∑–∂–µ)**
*   –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Tools) —Ç–æ–ª—å–∫–æ read/write –ø–æ —Ä–æ–ª—è–º.
*   –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π (–∫–Ω–æ–ø–∫–∞).
*   –ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ (Audit log).
*   **–ü—Ä–∏–µ–º–∫–∞ (Acceptance)**: –õ—é–±–æ–µ write‚Äë–¥–µ–π—Å—Ç–≤–∏–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è.
